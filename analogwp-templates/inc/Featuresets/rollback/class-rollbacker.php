<?php
/**
 * Rollbacker.
 *
 * @package Analog\Featuresets
 */

namespace Analog\Featuresets\Rollback;

if ( ! defined( 'ABSPATH' ) ) {
	exit; // Exit if accessed directly.
}

/**
 * Rollback.
 *
 * Rollback handler class is responsible for rolling back to
 * previous version.
 */
class Rollbacker {

	/**
	 * Package URL.
	 *
	 * Holds the package URL.
	 *
	 * @access protected
	 *
	 * @var string Package URL.
	 */
	protected $package_url;

	/**
	 * Version.
	 *
	 * Holds the version.
	 *
	 * @access protected
	 *
	 * @var string Package URL.
	 */
	protected $version;

	/**
	 * Plugin name.
	 *
	 * Holds the plugin name.
	 *
	 * @access protected
	 *
	 * @var string Plugin name.
	 */
	protected $plugin_name;

	/**
	 * Plugin slug.
	 *
	 * Holds the plugin slug.
	 *
	 * @access protected
	 *
	 * @var string Plugin slug.
	 */
	protected $plugin_slug;

	/**
	 * Rollback constructor.
	 *
	 * Initializing rollback.
	 *
	 * @access public
	 *
	 * @param array $args Optional. Rollback arguments. Default is an empty array.
	 */
	public function __construct( $args = array() ) {
		foreach ( $args as $key => $value ) {
			$this->{$key} = $value;
		}
	}

	/**
	 * Print inline style.
	 *
	 * Add an inline CSS to the rollback page.
	 *
	 * @access private
	 */
	private function print_inline_style() {
		?>
		<style>
			.wrap {
				overflow: hidden;
				max-width: 850px;
				margin: auto;
				font-family: Courier, monospace;
			}

			h1 {
				background: #F5EFEA;
				text-align: center;
				color: #252422 !important;
				padding: 70px !important;
				text-transform: uppercase;
				letter-spacing: 1px;
			}

			h1 img {
				max-width: 300px;
				display: block;
				margin: auto auto 50px;
			}

			.wrap h1 {
				position: relative;
				padding-top: 140px !important;
			}

			.wrap h1:before {
				content: '';
				position: absolute;
				width: 300px;
				height: 100px;
				color: #fff;
				top: 35px;
				background-image: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjIzIiBoZWlnaHQ9IjQyIiB2aWV3Qm94PSIwIDAgMjIzIDQyIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTI5Ljg0NTcgNC4zMTc1NkMyNi41OTc4IC0xLjQzOTE4IDE4LjQwMjIgLTEuNDM5MTkgMTUuMTU0MyA0LjMxNzU2TDEuMTI3MjMgMjkuMTc5N0MtMi4wOTU3NiAzNC44OTIyIDEuOTc2ODMgNDIgOC40NzI5NiA0MkgzNi41MjdDNDMuMDIzMiA0MiA0Ny4wOTU4IDM0Ljg5MjIgNDMuODcyOCAyOS4xNzk3TDI5Ljg0NTcgNC4zMTc1NlpNMjguNzc0MSAyMS41MDZDMjYgMTYuNTg5MSAxOSAxNi41ODkxIDE2LjIyNTkgMjEuNTA2QzEzLjQ3MzEgMjYuMzg1MiAxNi45NTE2IDMyLjQ1NiAyMi41IDMyLjQ1NkMyOC4wNDg0IDMyLjQ1NiAzMS41MjY5IDI2LjM4NTIgMjguNzc0MSAyMS41MDZaIiBmaWxsPSIjMUExQTFBIi8+CjxwYXRoIGQ9Ik03MC4zNiAzNC4zNkM2OC43NzYgMzQuMzYgNjcuMzQ4IDMzLjk2NCA2Ni4wNzYgMzMuMTcyQzY0LjgwNCAzMi4zOCA2My44MDggMzEuMyA2My4wODggMjkuOTMyQzYyLjM2OCAyOC41NjQgNjIuMDA4IDI3LjAyOCA2Mi4wMDggMjUuMzI0QzYyLjAwOCAyMy41OTYgNjIuMzY4IDIyLjA0OCA2My4wODggMjAuNjhDNjMuODA4IDE5LjMxMiA2NC44MDQgMTguMjMyIDY2LjA3NiAxNy40NEM2Ny4zNDggMTYuNjQ4IDY4Ljc3NiAxNi4yNTIgNzAuMzYgMTYuMjUyQzcxLjYwOCAxNi4yNTIgNzIuNzI0IDE2LjUwNCA3My43MDggMTcuMDA4Qzc0LjY5MiAxNy41MTIgNzUuNDcyIDE4LjIyIDc2LjA0OCAxOS4xMzJDNzYuNjQ4IDIwLjAyIDc2Ljk3MiAyMS4wMjggNzcuMDIgMjIuMTU2VjI4LjQyQzc2Ljk3MiAyOS41NzIgNzYuNjQ4IDMwLjU5MiA3Ni4wNDggMzEuNDhDNzUuNDcyIDMyLjM2OCA3NC42OTIgMzMuMDc2IDczLjcwOCAzMy42MDRDNzIuNzI0IDM0LjEwOCA3MS42MDggMzQuMzYgNzAuMzYgMzQuMzZaTTcxLjIyNCAzMC4wMDRDNzIuNTQ0IDMwLjAwNCA3My42MTIgMjkuNTcyIDc0LjQyOCAyOC43MDhDNzUuMjQ0IDI3LjgyIDc1LjY1MiAyNi42OCA3NS42NTIgMjUuMjg4Qzc1LjY1MiAyNC4zNzYgNzUuNDYgMjMuNTcyIDc1LjA3NiAyMi44NzZDNzQuNzE2IDIyLjE1NiA3NC4yIDIxLjYwNCA3My41MjggMjEuMjJDNzIuODggMjAuODEyIDcyLjExMiAyMC42MDggNzEuMjI0IDIwLjYwOEM3MC4zNiAyMC42MDggNjkuNTkyIDIwLjgxMiA2OC45MiAyMS4yMkM2OC4yNzIgMjEuNjA0IDY3Ljc1NiAyMi4xNTYgNjcuMzcyIDIyLjg3NkM2Ny4wMTIgMjMuNTcyIDY2LjgzMiAyNC4zNzYgNjYuODMyIDI1LjI4OEM2Ni44MzIgMjYuMjI0IDY3LjAxMiAyNy4wNTIgNjcuMzcyIDI3Ljc3MkM2Ny43NTYgMjguNDY4IDY4LjI3MiAyOS4wMiA2OC45MiAyOS40MjhDNjkuNTkyIDI5LjgxMiA3MC4zNiAzMC4wMDQgNzEuMjI0IDMwLjAwNFpNNzUuNCAzNFYyOS4zMkw3Ni4xNTYgMjUuMDcyTDc1LjQgMjAuODk2VjE2LjYxMkg4MC4wOFYzNEg3NS40Wk05NS45NTIxIDM0VjI0LjAyOEM5NS45NTIxIDIyLjk5NiA5NS42MjgxIDIyLjE1NiA5NC45ODAxIDIxLjUwOEM5NC4zMzIxIDIwLjg2IDkzLjQ5MjEgMjAuNTM2IDkyLjQ2MDEgMjAuNTM2QzkxLjc4ODEgMjAuNTM2IDkxLjE4ODEgMjAuNjggOTAuNjYwMSAyMC45NjhDOTAuMTMyMSAyMS4yNTYgODkuNzEyMSAyMS42NjQgODkuNDAwMSAyMi4xOTJDODkuMTEyMSAyMi43MiA4OC45NjgxIDIzLjMzMiA4OC45NjgxIDI0LjAyOEw4Ny4xMzIxIDIzLjA5MkM4Ny4xMzIxIDIxLjcyNCA4Ny40MjAxIDIwLjUzNiA4Ny45OTYxIDE5LjUyOEM4OC41OTYxIDE4LjQ5NiA4OS40MTIxIDE3LjY5MiA5MC40NDQxIDE3LjExNkM5MS41MDAxIDE2LjU0IDkyLjY4ODEgMTYuMjUyIDk0LjAwODEgMTYuMjUyQzk1LjI4MDEgMTYuMjUyIDk2LjQyMDEgMTYuNTc2IDk3LjQyODEgMTcuMjI0Qzk4LjQzNjEgMTcuODQ4IDk5LjIyODEgMTguNjc2IDk5LjgwNDEgMTkuNzA4QzEwMC4zOCAyMC43MTYgMTAwLjY2OCAyMS44MDggMTAwLjY2OCAyMi45ODRWMzRIOTUuOTUyMVpNODQuMjUyMSAzNFYxNi42MTJIODguOTY4MVYzNEg4NC4yNTIxWk0xMTEuNzM5IDM0LjM2QzExMC4xNTUgMzQuMzYgMTA4LjcyNyAzMy45NjQgMTA3LjQ1NSAzMy4xNzJDMTA2LjE4MyAzMi4zOCAxMDUuMTg3IDMxLjMgMTA0LjQ2NyAyOS45MzJDMTAzLjc0NyAyOC41NjQgMTAzLjM4NyAyNy4wMjggMTAzLjM4NyAyNS4zMjRDMTAzLjM4NyAyMy41OTYgMTAzLjc0NyAyMi4wNDggMTA0LjQ2NyAyMC42OEMxMDUuMTg3IDE5LjMxMiAxMDYuMTgzIDE4LjIzMiAxMDcuNDU1IDE3LjQ0QzEwOC43MjcgMTYuNjQ4IDExMC4xNTUgMTYuMjUyIDExMS43MzkgMTYuMjUyQzExMi45ODcgMTYuMjUyIDExNC4xMDMgMTYuNTA0IDExNS4wODcgMTcuMDA4QzExNi4wNzEgMTcuNTEyIDExNi44NTEgMTguMjIgMTE3LjQyNyAxOS4xMzJDMTE4LjAyNyAyMC4wMiAxMTguMzUxIDIxLjAyOCAxMTguMzk5IDIyLjE1NlYyOC40MkMxMTguMzUxIDI5LjU3MiAxMTguMDI3IDMwLjU5MiAxMTcuNDI3IDMxLjQ4QzExNi44NTEgMzIuMzY4IDExNi4wNzEgMzMuMDc2IDExNS4wODcgMzMuNjA0QzExNC4xMDMgMzQuMTA4IDExMi45ODcgMzQuMzYgMTExLjczOSAzNC4zNlpNMTEyLjYwMyAzMC4wMDRDMTEzLjkyMyAzMC4wMDQgMTE0Ljk5MSAyOS41NzIgMTE1LjgwNyAyOC43MDhDMTE2LjYyMyAyNy44MiAxMTcuMDMxIDI2LjY4IDExNy4wMzEgMjUuMjg4QzExNy4wMzEgMjQuMzc2IDExNi44MzkgMjMuNTcyIDExNi40NTUgMjIuODc2QzExNi4wOTUgMjIuMTU2IDExNS41NzkgMjEuNjA0IDExNC45MDcgMjEuMjJDMTE0LjI1OSAyMC44MTIgMTEzLjQ5MSAyMC42MDggMTEyLjYwMyAyMC42MDhDMTExLjczOSAyMC42MDggMTEwLjk3MSAyMC44MTIgMTEwLjI5OSAyMS4yMkMxMDkuNjUxIDIxLjYwNCAxMDkuMTM1IDIyLjE1NiAxMDguNzUxIDIyLjg3NkMxMDguMzkxIDIzLjU3MiAxMDguMjExIDI0LjM3NiAxMDguMjExIDI1LjI4OEMxMDguMjExIDI2LjIyNCAxMDguMzkxIDI3LjA1MiAxMDguNzUxIDI3Ljc3MkMxMDkuMTM1IDI4LjQ2OCAxMDkuNjUxIDI5LjAyIDExMC4yOTkgMjkuNDI4QzExMC45NzEgMjkuODEyIDExMS43MzkgMzAuMDA0IDExMi42MDMgMzAuMDA0Wk0xMTYuNzc5IDM0VjI5LjMyTDExNy41MzUgMjUuMDcyTDExNi43NzkgMjAuODk2VjE2LjYxMkgxMjEuNDU5VjM0SDExNi43NzlaTTEyNS42MzEgMzRWNy45NzJIMTMwLjM0N1YzNEgxMjUuNjMxWk0xNDIuNjk4IDM0LjM2QzE0MC45NDYgMzQuMzYgMTM5LjM2MiAzMy45NjQgMTM3Ljk0NiAzMy4xNzJDMTM2LjU1NCAzMi4zNTYgMTM1LjQzOCAzMS4yNjQgMTM0LjU5OCAyOS44OTZDMTMzLjc4MiAyOC41MDQgMTMzLjM3NCAyNi45NTYgMTMzLjM3NCAyNS4yNTJDMTMzLjM3NCAyMy41NDggMTMzLjc4MiAyMi4wMjQgMTM0LjU5OCAyMC42OEMxMzUuNDE0IDE5LjMxMiAxMzYuNTMgMTguMjMyIDEzNy45NDYgMTcuNDRDMTM5LjM2MiAxNi42MjQgMTQwLjkzNCAxNi4yMTYgMTQyLjY2MiAxNi4yMTZDMTQ0LjQzOCAxNi4yMTYgMTQ2LjAyMiAxNi42MjQgMTQ3LjQxNCAxNy40NEMxNDguODMgMTguMjMyIDE0OS45NDYgMTkuMzEyIDE1MC43NjIgMjAuNjhDMTUxLjU3OCAyMi4wMjQgMTUxLjk4NiAyMy41NDggMTUxLjk4NiAyNS4yNTJDMTUxLjk4NiAyNi45NTYgMTUxLjU3OCAyOC41MDQgMTUwLjc2MiAyOS44OTZDMTQ5Ljk0NiAzMS4yNjQgMTQ4LjgzIDMyLjM1NiAxNDcuNDE0IDMzLjE3MkMxNDYuMDIyIDMzLjk2NCAxNDQuNDUgMzQuMzYgMTQyLjY5OCAzNC4zNlpNMTQyLjY2MiAyOS45NjhDMTQzLjU1IDI5Ljk2OCAxNDQuMzMgMjkuNzc2IDE0NS4wMDIgMjkuMzkyQzE0NS42OTggMjguOTg0IDE0Ni4yMjYgMjguNDMyIDE0Ni41ODYgMjcuNzM2QzE0Ni45NyAyNy4wMTYgMTQ3LjE2MiAyNi4yIDE0Ny4xNjIgMjUuMjg4QzE0Ny4xNjIgMjQuMzc2IDE0Ni45NyAyMy41NzIgMTQ2LjU4NiAyMi44NzZDMTQ2LjIwMiAyMi4xOCAxNDUuNjc0IDIxLjY0IDE0NS4wMDIgMjEuMjU2QzE0NC4zMyAyMC44NDggMTQzLjU1IDIwLjY0NCAxNDIuNjYyIDIwLjY0NEMxNDEuNzk4IDIwLjY0NCAxNDEuMDMgMjAuODQ4IDE0MC4zNTggMjEuMjU2QzEzOS42ODYgMjEuNjQgMTM5LjE1OCAyMi4xOCAxMzguNzc0IDIyLjg3NkMxMzguMzkgMjMuNTcyIDEzOC4xOTggMjQuMzc2IDEzOC4xOTggMjUuMjg4QzEzOC4xOTggMjYuMiAxMzguMzkgMjcuMDE2IDEzOC43NzQgMjcuNzM2QzEzOS4xNTggMjguNDMyIDEzOS42ODYgMjguOTg0IDE0MC4zNTggMjkuMzkyQzE0MS4wMyAyOS43NzYgMTQxLjc5OCAyOS45NjggMTQyLjY2MiAyOS45NjhaTTE2Mi4yOTQgNDEuNzA0QzE2MC40NDYgNDEuNzA0IDE1OC44MTQgNDEuMzY4IDE1Ny4zOTggNDAuNjk2QzE1NS45ODIgNDAuMDQ4IDE1NC44NTQgMzkuMTI0IDE1NC4wMTQgMzcuOTI0TDE1Ny4wMDIgMzQuOTM2QzE1Ny42NzQgMzUuNzI4IDE1OC40MTggMzYuMzI4IDE1OS4yMzQgMzYuNzM2QzE2MC4wNzQgMzcuMTY4IDE2MS4wODIgMzcuMzg0IDE2Mi4yNTggMzcuMzg0QzE2My43MjIgMzcuMzg0IDE2NC44NzQgMzcuMDEyIDE2NS43MTQgMzYuMjY4QzE2Ni41NzggMzUuNTI0IDE2Ny4wMSAzNC40OTIgMTY3LjAxIDMzLjE3MlYyOC44MTZMMTY3LjgwMiAyNUwxNjcuMDQ2IDIxLjE4NFYxNi42MTJIMTcxLjcyNlYzMy4xQzE3MS43MjYgMzQuODI4IDE3MS4zMTggMzYuMzI4IDE3MC41MDIgMzcuNkMxNjkuNzEgMzguODk2IDE2OC42MDYgMzkuOTA0IDE2Ny4xOSA0MC42MjRDMTY1Ljc3NCA0MS4zNDQgMTY0LjE0MiA0MS43MDQgMTYyLjI5NCA0MS43MDRaTTE2Mi4wNzggMzMuNTMyQzE2MC41MTggMzMuNTMyIDE1OS4xMTQgMzMuMTYgMTU3Ljg2NiAzMi40MTZDMTU2LjYxOCAzMS42NDggMTU1LjYzNCAzMC42MDQgMTU0LjkxNCAyOS4yODRDMTU0LjIxOCAyNy45NjQgMTUzLjg3IDI2LjQ4OCAxNTMuODcgMjQuODU2QzE1My44NyAyMy4yMjQgMTU0LjIxOCAyMS43NiAxNTQuOTE0IDIwLjQ2NEMxNTUuNjM0IDE5LjE2OCAxNTYuNjE4IDE4LjE0OCAxNTcuODY2IDE3LjQwNEMxNTkuMTE0IDE2LjYzNiAxNjAuNTE4IDE2LjI1MiAxNjIuMDc4IDE2LjI1MkMxNjMuMzc0IDE2LjI1MiAxNjQuNTE0IDE2LjUwNCAxNjUuNDk4IDE3LjAwOEMxNjYuNTA2IDE3LjUxMiAxNjcuMjk4IDE4LjIwOCAxNjcuODc0IDE5LjA5NkMxNjguNDUgMTkuOTYgMTY4Ljc2MiAyMC45OCAxNjguODEgMjIuMTU2VjI3LjYyOEMxNjguNzYyIDI4Ljc4IDE2OC40MzggMjkuODEyIDE2Ny44MzggMzAuNzI0QzE2Ny4yNjIgMzEuNjEyIDE2Ni40NyAzMi4zMDggMTY1LjQ2MiAzMi44MTJDMTY0LjQ3OCAzMy4yOTIgMTYzLjM1IDMzLjUzMiAxNjIuMDc4IDMzLjUzMlpNMTYzLjAxNCAyOS4yNDhDMTYzLjg3OCAyOS4yNDggMTY0LjYyMiAyOS4wNjggMTY1LjI0NiAyOC43MDhDMTY1Ljg5NCAyOC4zMjQgMTY2LjM5OCAyNy44MDggMTY2Ljc1OCAyNy4xNkMxNjcuMTE4IDI2LjQ4OCAxNjcuMjk4IDI1LjczMiAxNjcuMjk4IDI0Ljg5MkMxNjcuMjk4IDI0LjAyOCAxNjcuMTE4IDIzLjI3MiAxNjYuNzU4IDIyLjYyNEMxNjYuMzk4IDIxLjk3NiAxNjUuODk0IDIxLjQ3MiAxNjUuMjQ2IDIxLjExMkMxNjQuNjIyIDIwLjcyOCAxNjMuODc4IDIwLjUzNiAxNjMuMDE0IDIwLjUzNkMxNjIuMTUgMjAuNTM2IDE2MS4zOTQgMjAuNzI4IDE2MC43NDYgMjEuMTEyQzE2MC4wOTggMjEuNDcyIDE1OS41OTQgMjEuOTg4IDE1OS4yMzQgMjIuNjZDMTU4Ljg3NCAyMy4zMDggMTU4LjY5NCAyNC4wNTIgMTU4LjY5NCAyNC44OTJDMTU4LjY5NCAyNS43MDggMTU4Ljg3NCAyNi40NTIgMTU5LjIzNCAyNy4xMjRDMTU5LjU5NCAyNy43NzIgMTYwLjA5OCAyOC4yODggMTYwLjc0NiAyOC42NzJDMTYxLjM5NCAyOS4wNTYgMTYyLjE1IDI5LjI0OCAxNjMuMDE0IDI5LjI0OFpNMTgwLjUxMyAzNEwxNzMuOTk3IDE2LjYxMkgxNzguNzQ5TDE4Mi45OTcgMjkuMjQ4TDE4MS41NTcgMjkuMjg0TDE4NS45MTMgMTYuNjEySDE4OS4zMzNMMTkzLjY4OSAyOS4yODRMMTkyLjI0OSAyOS4yNDhMMTk2LjQ5NyAxNi42MTJIMjAxLjI0OUwxOTQuNzY5IDM0SDE5MS4zNDlMMTg2Ljk1NyAyMS45NzZIMTg4LjI4OUwxODMuODk3IDM0SDE4MC41MTNaTTIxMy4xODUgMzQuMzZDMjExLjkzNyAzNC4zNiAyMTAuODA5IDM0LjEwOCAyMDkuODAxIDMzLjYwNEMyMDguNzkzIDMzLjA3NiAyMDcuOTg5IDMyLjM2OCAyMDcuMzg5IDMxLjQ4QzIwNi43ODkgMzAuNTkyIDIwNi40NjUgMjkuNTcyIDIwNi40MTcgMjguNDJWMjIuMjY0QzIwNi40NjUgMjEuMTEyIDIwNi43ODkgMjAuMDkyIDIwNy4zODkgMTkuMjA0QzIwOC4wMTMgMTguMjkyIDIwOC44MTcgMTcuNTcyIDIwOS44MDEgMTcuMDQ0QzIxMC44MDkgMTYuNTE2IDIxMS45MzcgMTYuMjUyIDIxMy4xODUgMTYuMjUyQzIxNC43OTMgMTYuMjUyIDIxNi4yMzMgMTYuNjQ4IDIxNy41MDUgMTcuNDRDMjE4Ljc3NyAxOC4yMzIgMjE5Ljc3MyAxOS4zMTIgMjIwLjQ5MyAyMC42OEMyMjEuMjM3IDIyLjA0OCAyMjEuNjA5IDIzLjU5NiAyMjEuNjA5IDI1LjMyNEMyMjEuNjA5IDI3LjAyOCAyMjEuMjM3IDI4LjU2NCAyMjAuNDkzIDI5LjkzMkMyMTkuNzczIDMxLjMgMjE4Ljc3NyAzMi4zOCAyMTcuNTA1IDMzLjE3MkMyMTYuMjMzIDMzLjk2NCAyMTQuNzkzIDM0LjM2IDIxMy4xODUgMzQuMzZaTTIwMy41MzcgNDEuMjcyVjE2LjYxMkgyMDguMjUzVjIxLjE4NEwyMDcuNDYxIDI1LjM5NkwyMDguMjE3IDI5LjYwOFY0MS4yNzJIMjAzLjUzN1pNMjEyLjM1NyAzMC4wMDRDMjEzLjIyMSAzMC4wMDQgMjEzLjk4OSAyOS44MTIgMjE0LjY2MSAyOS40MjhDMjE1LjMzMyAyOS4wMiAyMTUuODQ5IDI4LjQ2OCAyMTYuMjA5IDI3Ljc3MkMyMTYuNTkzIDI3LjA1MiAyMTYuNzg1IDI2LjIyNCAyMTYuNzg1IDI1LjI4OEMyMTYuNzg1IDI0LjM3NiAyMTYuNTkzIDIzLjU3MiAyMTYuMjA5IDIyLjg3NkMyMTUuODQ5IDIyLjE1NiAyMTUuMzMzIDIxLjYwNCAyMTQuNjYxIDIxLjIyQzIxMy45ODkgMjAuODEyIDIxMy4yMjEgMjAuNjA4IDIxMi4zNTcgMjAuNjA4QzIxMS41MTcgMjAuNjA4IDIxMC43NjEgMjAuODEyIDIxMC4wODkgMjEuMjJDMjA5LjQxNyAyMS42MDQgMjA4Ljg4OSAyMi4xNTYgMjA4LjUwNSAyMi44NzZDMjA4LjE0NSAyMy41NzIgMjA3Ljk2NSAyNC4zNzYgMjA3Ljk2NSAyNS4yODhDMjA3Ljk2NSAyNi4yMjQgMjA4LjE0NSAyNy4wNTIgMjA4LjUwNSAyNy43NzJDMjA4Ljg4OSAyOC40NjggMjA5LjQwNSAyOS4wMiAyMTAuMDUzIDI5LjQyOEMyMTAuNzI1IDI5LjgxMiAyMTEuNDkzIDMwLjAwNCAyMTIuMzU3IDMwLjAwNFoiIGZpbGw9IiMxQTFBMUEiLz4KPC9zdmc+Cg==");
				background-repeat: no-repeat;
				transform: translate(10%);
			}
		</style>
		<?php
	}

	/**
	 * Upgrade.
	 *
	 * Run WordPress upgrade to rollback plugin to previous version.
	 *
	 * @access protected
	 */
	protected function upgrade() {
		if ( ! class_exists( 'WP_Upgrader_Skin' ) ) {
			require_once ABSPATH . 'wp-admin/includes/class-wp-upgrader.php';
		}

		require_once __DIR__ . '/class-rollback-downgrader-skin.php';

		$skin_args = array(
			'url'    => 'update.php?action=upgrade-plugin&plugin=' . rawurlencode( $this->plugin_name ),
			'plugin' => $this->plugin_name,
			'nonce'  => 'upgrade-plugin_' . $this->plugin_name,
			'title'  => esc_html__( 'Rollback to Previous Version', 'analogwp-library' ),
		);

		$this->print_inline_style();

		$skin     = new Rollback_Downgrader_Skin( $skin_args );
		$upgrader = new \Plugin_Upgrader( $skin );

		// IMPORTANT: initialize + install strings so feedback() can map keys.
		$upgrader->init();
		$upgrader->upgrade_strings();
		$upgrader->run(
			array(
				'package'                     => $this->package_url,
				'destination'                 => WP_PLUGIN_DIR,
				'abort_if_destination_exists' => false,
				'clear_working'               => true,
				'hook_extra'                  => array(
					'plugin' => $this->plugin_name,
					'type'   => 'plugin',
					'action' => 'update',
				),
			)
		);
	}

	/**
	 * Run.
	 *
	 * Rollback plugin to previous versions.
	 *
	 * @access public
	 */
	public function run() {
		$this->upgrade();
	}
}